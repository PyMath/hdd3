<!DOCTYPE html>
<html>
  <head>
    <title>Prototyping Parallel Coord</title>
    <script type="text/javascript" src="lib/d3.js"></script>
  </head>
  <body>

    <div id="viz"></div>

    <script type="text/javascript">

    // generate random data
    function randpoint() {
      return {
        x:Math.random()*5,
        y:Math.random(),
        z:Math.random()*3,
        t:Math.random()*7,
      }
    }
    var data = {
      'traits': ['x', 'y', 'z', 't'],
      'category': 1,
      'values' : d3.range(50).map(randpoint)
    };

    // constants
    var height = 400,
        eachWidth = 150, // should be passed in
        padding = 20;

    // getter and scale
    var get = {}, scale = {}, scaleGet = {};
    data.traits.forEach(function(trait) {
      // getter
      getter = function(d) { return d[trait] }
      get[trait] = getter
      // scale
      domain = [d3.min(data.values, getter), d3.max(data.values, getter)]
      scale[trait] = d3.scale.linear().domain(domain).range([height, 0])
      scaleGet[trait] = function(d) { return scale[trait](d[trait]) }
    });

    // chart
    var parallel = d3.select("#viz")
        .append("svg")
        .attr("class", "chart")
        .attr("width", eachWidth * data.traits.length + 2*padding)
        .attr("height", height + 2*padding);

    // axes
    var axes = d3.svg.axis()
        .ticks(4)
        .tickSize(1)

    parallel.selectAll("g.axis")
        .data(data.traits)
        .enter().append("svg:g")
        .attr("class", "y axis")
        .attr("transform",
              function(d, i) {
                return "translate("+((i*eachWidth)+padding)+","+padding+")"
              })
        .each(function(d){
          d3.select(this).call(axes.scale(scale[d]).orient("left"));
        });

    // points
    var cell = parallel.selectAll("g.cell")
        .data(data.traits)
        .enter().append("g")
        .attr("class", "cell")
        .attr("transform", function(d, i) {
         return "translate(" + (i*eachWidth+padding)+ "," + padding + ")";
        })
        .each(plotPoints);

    function plotPoints(trait) {
      var cell = d3.select(this);
      cell.selectAll("circle")
        .data(data.values)
        .enter().append("circle")
        .attr("cx", 0)
        .attr("cy", scaleGet[trait])
        .attr("r", 3)
        .attr("fill", "#84BD8D")
     }

     // lines
     var lines = parallel.selectAll("g.line")
         .data(data.values)
         .enter().append("svg:g")
         .attr("transform", "translate(0,"+padding+")")
         .each (plotLines)

    function plotLines(point) {
      var lines = d3.select(this)
      for (var i = 0; i < data.traits.length - 1; i++) {
        current = data.traits[i]
        next = data.traits[i+1]

        lines.append("svg:line")
            .attr("x1", padding + i*eachWidth)
            .attr("y1", scaleGet[current](point))
            .attr("x2", padding + (i+1)*eachWidth)
            .attr("y2", scaleGet[next](point))
            .attr("width", 1)
            .attr("stroke", "#84BD8D")
      }
    }
    </script>

  </body>
</html>
